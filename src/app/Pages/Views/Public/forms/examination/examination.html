<!-- Hero Section -->
<div class="relative h-[180px] sm:h-[200px] md:h-[220px] overflow-hidden">
  <div class="absolute inset-0 bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-600"></div>
  <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent"></div>
  <div class="absolute inset-0 flex items-center">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 md:px-8 w-full text-center">
      <div class="inline-block mb-2 sm:mb-2.5 px-3 sm:px-4 py-1 sm:py-1.5 bg-blue-500/20 backdrop-blur-sm rounded-full border border-blue-400/30">
        <span class="text-blue-100 text-xs sm:text-sm font-semibold">üìù Examination Form</span>
      </div>
      <h1 class="text-2xl xs:text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-extrabold mb-2 sm:mb-2.5 md:mb-3 leading-tight drop-shadow-2xl text-white px-2">
        Examination Form
      </h1>
      <p class="text-sm sm:text-base md:text-lg lg:text-xl xl:text-2xl text-blue-100 font-medium drop-shadow-lg leading-relaxed max-w-3xl mx-auto px-2">
        Complete your examination application step by step
      </p>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="bg-gradient-to-b from-gray-50 via-white to-gray-50 py-4 sm:py-6 md:py-8 print:py-4 print:bg-white">
  <div class="max-w-5xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8 print:px-6">
    
    <!-- Form Container -->
    <div id="examination-form-content" class="bg-white shadow-2xl rounded-lg sm:rounded-xl lg:rounded-2xl xl:rounded-3xl border-2 border-gray-200 p-3 sm:p-4 md:p-5 print:p-8 print:bg-white print:shadow-none print:border-0 print:rounded-none relative overflow-hidden">
      <!-- Decorative Background -->
      <div class="absolute top-0 right-0 w-64 h-64 bg-blue-200/20 rounded-full blur-3xl -z-10 print:hidden"></div>
      <div class="absolute bottom-0 left-0 w-48 h-48 bg-indigo-200/20 rounded-full blur-3xl -z-10 print:hidden"></div>

      <!-- Verification Form (Show if not verified) -->
      <div *ngIf="!isVerified" class="space-y-6 animate-fadeIn">
        <div class="bg-white rounded-xl p-5 sm:p-6 md:p-8 border-2 border-gray-200 shadow-lg">
          <div class="flex items-center mb-5 sm:mb-6">
            <div class="w-14 h-14 sm:w-16 sm:h-16 flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl mr-3 sm:mr-4 shadow-lg">
              <i class="ri-shield-check-line text-2xl sm:text-3xl text-white"></i>
            </div>
            <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-gray-900">Student Verification</h2>
          </div>

          <p class="text-sm sm:text-base text-gray-600 mb-3 sm:mb-4">
            Please enter your Enrolment Number and Date of Birth to verify your identity and auto-fill the form.
          </p>

          <!-- Test Credentials Info -->
          <div class="bg-blue-50 border-l-4 border-blue-500 text-blue-800 p-3 sm:p-4 rounded-lg mb-5 sm:mb-6">
            <div class="flex items-start gap-2">
              <i class="ri-information-line text-lg mt-0.5"></i>
              <div class="flex-1">
                <p class="font-semibold text-sm mb-2">Test Credentials (For Testing):</p>
                <div class="text-xs space-y-1">
                  <p><strong>Option 1:</strong> Enrolment: <code class="bg-blue-100 px-1.5 py-0.5 rounded">CIPC-2025-0101-12345</code> | DOB: <code class="bg-blue-100 px-1.5 py-0.5 rounded">15/01/2000</code></p>
                  <p><strong>Option 2:</strong> Enrolment: <code class="bg-blue-100 px-1.5 py-0.5 rounded">CIPC-2025-0101-54321</code> | DOB: <code class="bg-blue-100 px-1.5 py-0.5 rounded">20/05/1999</code></p>
                  <p><strong>Option 3:</strong> Enrolment: <code class="bg-blue-100 px-1.5 py-0.5 rounded">TEST123</code> | DOB: <code class="bg-blue-100 px-1.5 py-0.5 rounded">25/12/2001</code></p>
                </div>
              </div>
            </div>
          </div>

          <form [formGroup]="verificationForm" (ngSubmit)="verifyStudent()" class="space-y-5">
            <!-- Enrolment Number -->
            <div>
              <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                Enrolment Number: <span class="text-red-600">*</span>
              </label>
              <input type="text" formControlName="enrolmentNumber" 
                class="w-full border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                [class.border-red-500]="verificationForm.get('enrolmentNumber')?.invalid && verificationForm.get('enrolmentNumber')?.touched"
                placeholder="Enter your enrolment number">
              <p *ngIf="verificationForm.get('enrolmentNumber')?.invalid && verificationForm.get('enrolmentNumber')?.touched" 
                class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                <i class="ri-error-warning-line text-sm"></i>
                Enrolment number is required (minimum 5 characters)
              </p>
            </div>

            <!-- Date of Birth -->
            <div>
              <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                Date of Birth: <span class="text-red-600">*</span>
              </label>
              
              <!-- Calendar Datepicker -->
              <div class="mb-3">
                <div class="flex items-center gap-2 bg-blue-50 border-2 border-blue-200 rounded-lg px-3 py-2 hover:border-blue-400 transition-colors">
                  <i class="ri-calendar-line text-blue-600 text-lg"></i>
                  <mat-form-field appearance="fill" class="m-0 p-0 w-full">
                    <input matInput [matDatepicker]="verifyPicker" formControlName="dateOfBirthFull" 
                      (dateChange)="onVerificationDateSelected($event)"
                      [max]="maxDateDOB"
                      readonly
                      class="border-0 bg-transparent px-2 py-1 text-sm focus:outline-none w-full cursor-pointer"
                      placeholder="Select Date from Calendar">
                    <mat-datepicker-toggle matIconSuffix [for]="verifyPicker" class="text-blue-600"></mat-datepicker-toggle>
                    <mat-datepicker #verifyPicker></mat-datepicker>
                  </mat-form-field>
                </div>
              </div>

              <!-- Manual Date Input -->
              <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                <p class="text-xs text-gray-600 mb-2 flex items-center gap-1">
                  <i class="ri-information-line"></i>
                  Or enter manually:
                </p>
                <div class="grid grid-cols-3 gap-2">
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">Day</label>
                    <input type="number" formControlName="dateOfBirth" maxlength="2" min="1" max="31"
                      (input)="validateVerificationDateInput($event, 'dateOfBirth', 1, 31)"
                      (blur)="syncVerificationDateFromManualInputs()"
                      class="w-full border-2 border-gray-300 bg-white px-2 py-1 text-xs rounded-md focus:outline-none focus:border-blue-500"
                      [class.border-red-500]="verificationForm.get('dateOfBirth')?.invalid && verificationForm.get('dateOfBirth')?.touched"
                      placeholder="DD">
                  </div>
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">Month</label>
                    <input type="number" formControlName="monthOfBirth" maxlength="2" min="1" max="12"
                      (input)="validateVerificationDateInput($event, 'monthOfBirth', 1, 12)"
                      (blur)="syncVerificationDateFromManualInputs()"
                      class="w-full border-2 border-gray-300 bg-white px-2 py-1 text-xs rounded-md focus:outline-none focus:border-blue-500"
                      [class.border-red-500]="verificationForm.get('monthOfBirth')?.invalid && verificationForm.get('monthOfBirth')?.touched"
                      placeholder="MM">
                  </div>
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">Year</label>
                    <input type="number" formControlName="yearOfBirth" maxlength="4" min="1950" [max]="maxDateDOB.getFullYear()"
                      (input)="syncVerificationDateFromManualInputs()"
                      class="w-full border-2 border-gray-300 bg-white px-2 py-1 text-xs rounded-md focus:outline-none focus:border-blue-500"
                      [class.border-red-500]="verificationForm.get('yearOfBirth')?.invalid && verificationForm.get('yearOfBirth')?.touched"
                      placeholder="YYYY">
                  </div>
                </div>
                <p *ngIf="verificationForm.get('dateOfBirth')?.value && verificationForm.get('monthOfBirth')?.value && verificationForm.get('yearOfBirth')?.value" 
                  class="text-xs text-gray-500 mt-2 flex items-center gap-1">
                  <i class="ri-check-line text-green-600"></i>
                  Selected: {{ verificationForm.get('dateOfBirth')?.value }}/{{ verificationForm.get('monthOfBirth')?.value }}/{{ verificationForm.get('yearOfBirth')?.value }}
                </p>
                <p *ngIf="(verificationForm.get('dateOfBirth')?.invalid || verificationForm.get('monthOfBirth')?.invalid || verificationForm.get('yearOfBirth')?.invalid) && (verificationForm.get('dateOfBirth')?.touched || verificationForm.get('monthOfBirth')?.touched || verificationForm.get('yearOfBirth')?.touched)" 
                  class="text-red-600 text-[10px] mt-1 flex items-center gap-1 bg-red-50 p-1 rounded-md">
                  <i class="ri-error-warning-line"></i>
                  Please enter a valid date of birth
                </p>
              </div>
            </div>

            <!-- Error Message -->
            <div *ngIf="verificationError" class="bg-red-50 border-l-4 border-red-500 text-red-700 p-3 rounded-lg">
              <div class="flex items-center gap-2">
                <i class="ri-error-warning-line text-lg"></i>
                <p class="text-sm font-semibold">{{ verificationError }}</p>
              </div>
            </div>

            <!-- Verify Button -->
            <button type="submit" 
              [disabled]="isVerifying || verificationForm.invalid"
              class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg font-semibold text-sm transition-all shadow-md hover:shadow-lg transform hover:scale-105 disabled:transform-none flex items-center justify-center gap-2">
              <i *ngIf="!isVerifying" class="ri-shield-check-line text-base"></i>
              <i *ngIf="isVerifying" class="ri-loader-4-line text-base animate-spin"></i>
              {{ isVerifying ? 'Verifying...' : 'Verify & Continue' }}
            </button>
          </form>
        </div>
      </div>

      <!-- Examination Form (Show only if verified) -->
      <div *ngIf="isVerified">
      <!-- College Logo and Name Header -->
      <div class="flex flex-col sm:flex-row items-center justify-center gap-4 sm:gap-6 mb-6 sm:mb-8 print:mb-4 pb-6 sm:pb-8 border-b-2 border-gray-300 print:border-b print:border-black">
        <!-- College Logo -->
        <div class="flex-shrink-0">
          <img src="Assets/logos/image.png" alt="CIPC Logo" 
               class="h-20 sm:h-24 md:h-28 w-auto max-w-[200px] sm:max-w-[240px] md:max-w-[280px] object-contain print:h-20 print:max-w-[180px]"
               onerror="this.onerror=null; this.src='Assets/logos/image.png';">
        </div>
        <!-- College Name and Details -->
        <div class="flex-1 text-center sm:text-left">
          <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-800 mb-2 print:text-xl">
            CIPC PARAMEDICAL COUNCIL
          </h1>
          <p class="text-sm sm:text-base text-gray-600 print:text-xs">
            Varanasi, Uttar Pradesh, India
          </p>
          <p class="text-xs sm:text-sm text-gray-500 mt-1 print:text-[10px]">
            ISO Certified Institution
          </p>
        </div>
      </div>

      <!-- Step Progress Indicator -->
      <div class="mb-8 print:hidden">
        <div class="flex items-center justify-between mb-4">
          <div *ngFor="let step of steps; let i = index" class="flex items-center flex-1">
            <div class="flex flex-col items-center flex-1">
              <button type="button" (click)="goToStep(step.number)" 
                [class]="currentStep >= step.number 
                  ? 'w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-br from-blue-500 to-indigo-600 text-white shadow-lg' 
                  : 'w-12 h-12 sm:w-14 sm:h-14 bg-gray-200 text-gray-500'"
                class="rounded-full flex items-center justify-center font-bold text-sm sm:text-base transition-all duration-300 hover:scale-110 cursor-pointer relative z-10">
                <i *ngIf="currentStep > step.number" class="ri-check-line text-xl"></i>
                <span *ngIf="currentStep <= step.number">{{ step.number }}</span>
              </button>
              <p class="mt-2 text-xs sm:text-sm font-semibold text-center max-w-[100px]"
                [class.text-blue-600]="currentStep >= step.number"
                [class.text-gray-500]="currentStep < step.number">
                {{ step.title }}
              </p>
            </div>
            <div *ngIf="i < steps.length - 1" 
              [class]="currentStep > step.number 
                ? 'h-1 bg-gradient-to-r from-blue-500 to-indigo-600' 
                : 'h-1 bg-gray-200'"
              class="flex-1 mx-2 -mt-6 transition-all duration-300"></div>
          </div>
        </div>
      </div>

      <!-- Form Fields -->
      <form [formGroup]="examinationForm" (ngSubmit)="onSubmit()" class="space-y-6 print:space-y-3">
        
        <!-- STEP 1: Personal Information -->
        <div *ngIf="currentStep === 1" class="space-y-6 animate-fadeIn">
          <div class="bg-white rounded-xl p-5 sm:p-6 md:p-8 border-2 border-gray-200 shadow-lg">
            <div class="flex items-center mb-5 sm:mb-6">
              <div class="w-14 h-14 sm:w-16 sm:h-16 flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl mr-3 sm:mr-4 shadow-lg">
                <i class="ri-user-line text-2xl sm:text-3xl text-white"></i>
              </div>
              <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-gray-900">Personal Information</h2>
            </div>

            <!-- Photo Upload Section -->
            <div class="mb-5 sm:mb-6 p-4 sm:p-5 bg-gray-50 rounded-xl border-2 border-gray-200 shadow-md hover:shadow-lg transition-all">
              <label class="block font-bold text-sm sm:text-base text-gray-700 mb-3 sm:mb-4 flex items-center gap-2">
                <i class="ri-camera-line text-blue-600"></i>
                Student Photo: <span class="text-gray-500 text-xs font-normal">(Optional but recommended)</span>
              </label>
              <div class="flex flex-col sm:flex-row items-center gap-5 sm:gap-6">
                <div class="w-32 h-32 sm:w-36 sm:h-36 md:w-44 md:h-44 border-3 border-dashed border-blue-300 rounded-2xl flex items-center justify-center bg-gradient-to-br from-blue-50 to-white overflow-hidden shadow-inner hover:border-blue-400 transition-all group relative">
                  <div *ngIf="studentPhotoPreview" class="relative w-full h-full">
                    <img [src]="studentPhotoPreview" alt="Student Photo" 
                         class="w-full h-full object-cover rounded-xl">
                    <button type="button" (click)="removePhoto()" 
                            class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full p-1.5 shadow-lg hover:shadow-xl transition-all flex items-center justify-center group/btn">
                      <i class="ri-close-line text-sm group-hover/btn:rotate-90 transition-transform"></i>
                    </button>
                  </div>
                  <div *ngIf="!studentPhotoPreview" class="text-center p-4">
                    <i class="ri-camera-line text-4xl sm:text-5xl text-blue-400 mb-2 group-hover:text-blue-600 transition-colors"></i>
                    <p class="text-xs sm:text-sm text-gray-500 font-medium">No Photo</p>
                  </div>
                </div>
                <div class="flex-1 w-full sm:w-auto">
                  <input type="file" id="studentPhotoInput" 
                         accept="image/jpeg,image/jpg,image/png,image/gif"
                         (change)="onPhotoSelected($event)"
                         class="hidden">
                  <label for="studentPhotoInput" 
                         class="cursor-pointer inline-flex items-center justify-center gap-2 text-white bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-600 hover:from-blue-700 hover:via-blue-800 hover:to-indigo-700 px-5 sm:px-6 py-2.5 sm:py-3 rounded-lg shadow-lg hover:shadow-xl transition-all font-semibold text-sm sm:text-base transform hover:scale-105 w-full sm:w-auto">
                    <i class="ri-upload-cloud-2-line text-lg"></i>
                    <span>{{ studentPhotoPreview ? 'Change Photo' : 'Upload Photo' }}</span>
                  </label>
                  <p class="text-[10px] sm:text-xs text-gray-500 mt-2 flex items-center gap-1">
                    <i class="ri-information-line"></i>
                    Max 2MB, JPG/PNG format
                  </p>
                </div>
              </div>
            </div>

            <!-- Form Number -->
            <div class="mb-5 sm:mb-6">
              <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">Form Number (For office use only):</label>
              <input type="text" formControlName="formNumber" 
                class="w-full border-2 border-gray-300 bg-gray-100 px-3 py-2 text-sm rounded-lg cursor-not-allowed"
                readonly>
            </div>

            <!-- Enrolment Number and Student Name -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-5">
              <div>
                <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                  Enrolment Number: <span class="text-red-600">*</span>
                </label>
                <input type="text" formControlName="enrolmentNumber" 
                  class="w-full border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                  [class.border-red-500]="hasError('enrolmentNumber')"
                  placeholder="Enter enrolment number">
                <p *ngIf="hasError('enrolmentNumber')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                  <i class="ri-error-warning-line text-sm"></i>
                  {{ getErrorMessage('enrolmentNumber') }}
                </p>
              </div>

              <div>
                <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                  Student Name (In Capital Letters): <span class="text-red-600">*</span>
                </label>
                <input type="text" formControlName="studentName" 
                  class="w-full border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all uppercase font-semibold"
                  [class.border-red-500]="hasError('studentName')"
                  placeholder="Enter your full name">
                <p *ngIf="hasError('studentName')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                  <i class="ri-error-warning-line text-sm"></i>
                  {{ getErrorMessage('studentName') }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 2: Exam Details -->
        <div *ngIf="currentStep === 2" class="space-y-6 animate-fadeIn">
          <div class="bg-white rounded-xl p-5 sm:p-6 md:p-8 border-2 border-gray-200 shadow-lg">
            <div class="flex items-center mb-5 sm:mb-6">
              <div class="w-14 h-14 sm:w-16 sm:h-16 flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl mr-3 sm:mr-4 shadow-lg">
                <i class="ri-file-list-line text-2xl sm:text-3xl text-white"></i>
              </div>
              <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-gray-900">Exam Details</h2>
            </div>

            <!-- Course and Exam Type -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-5 mb-5 sm:mb-6">
              <div>
                <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                  Course: <span class="text-red-600">*</span>
                </label>
                <mat-form-field appearance="fill" class="m-0 p-0 w-full">
                  <input type="text" matInput formControlName="course" 
                    [matAutocomplete]="autoCourse"
                    placeholder="Search or select course"
                    class="border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 w-full"
                    [class.border-red-500]="hasError('course')">
                  <mat-autocomplete #autoCourse="matAutocomplete" [displayWith]="displayCourse">
                    <mat-option *ngFor="let course of filteredCourses | async" [value]="course" class="text-sm py-2.5 px-4 min-h-[40px] hover:bg-blue-50">
                      <i class="ri-book-line text-blue-600 mr-2"></i>{{ course }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                <p *ngIf="hasError('course')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                  <i class="ri-error-warning-line text-sm"></i>
                  {{ getErrorMessage('course') }}
                </p>
              </div>

              <div>
                <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                  Exam Type: <span class="text-red-600">*</span>
                </label>
                <mat-form-field appearance="fill" class="m-0 p-0 w-full">
                  <input type="text" matInput formControlName="examType" 
                    [matAutocomplete]="autoExamType"
                    placeholder="Search or select exam type"
                    class="border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 w-full"
                    [class.border-red-500]="hasError('examType')">
                  <mat-autocomplete #autoExamType="matAutocomplete" [displayWith]="displayExamType">
                    <mat-option *ngFor="let type of filteredExamTypes | async" [value]="type" class="text-sm py-2.5 px-4 min-h-[40px] hover:bg-blue-50">
                      <i class="ri-file-list-line text-blue-600 mr-2"></i>{{ type }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                <p *ngIf="hasError('examType')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                  <i class="ri-error-warning-line text-sm"></i>
                  {{ getErrorMessage('examType') }}
                </p>
              </div>
            </div>

            <!-- Exam Date and Subject -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-5 mb-5 sm:mb-6">
              <div>
                <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                  Exam Date: <span class="text-red-600">*</span>
                </label>
                <div class="flex items-center gap-2 bg-blue-50 border-2 border-blue-200 rounded-lg px-3 py-2 hover:border-blue-400 transition-colors">
                  <i class="ri-calendar-line text-blue-600 text-lg"></i>
                  <mat-form-field appearance="fill" class="m-0 p-0 w-full">
                    <input matInput [matDatepicker]="picker" formControlName="examDateFull" 
                      (dateChange)="onDateSelected($event)"
                      [max]="maxDate"
                      [min]="startDate"
                      readonly
                      class="border-0 bg-transparent px-2 py-1 text-sm focus:outline-none w-full"
                      [class.text-red-500]="hasError('examDate')">
                    <mat-datepicker-toggle matIconSuffix [for]="picker" class="text-blue-600"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                  </mat-form-field>
                </div>
                <input type="text" formControlName="examDate" 
                  class="w-full border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all mt-2"
                  placeholder="DD/MM/YYYY"
                  [class.border-red-500]="hasError('examDate')">
                <p *ngIf="hasError('examDate')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                  <i class="ri-error-warning-line text-sm"></i>
                  {{ getErrorMessage('examDate') }}
                </p>
              </div>

              <div>
                <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                  Subject/Paper: <span class="text-red-600">*</span>
                </label>
                <input type="text" formControlName="subject" 
                  class="w-full border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                  [class.border-red-500]="hasError('subject')"
                  placeholder="Enter subject/paper name">
                <p *ngIf="hasError('subject')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                  <i class="ri-error-warning-line text-sm"></i>
                  {{ getErrorMessage('subject') }}
                </p>
              </div>
            </div>

            <!-- Exam Center -->
            <div>
              <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                Exam Center: <span class="text-red-600">*</span>
              </label>
              <mat-form-field appearance="fill" class="m-0 p-0 w-full">
                <input type="text" matInput formControlName="examCenter" 
                  [matAutocomplete]="autoExamCenter"
                  placeholder="Search or select exam center"
                  class="border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 w-full"
                  [class.border-red-500]="hasError('examCenter')">
                <mat-autocomplete #autoExamCenter="matAutocomplete" [displayWith]="displayExamCenter">
                  <mat-option *ngFor="let center of filteredExamCenters | async" [value]="center" class="text-sm py-2.5 px-4 min-h-[40px] hover:bg-blue-50">
                    <i class="ri-building-line text-blue-600 mr-2"></i>{{ center }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <p *ngIf="hasError('examCenter')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                <i class="ri-error-warning-line text-sm"></i>
                {{ getErrorMessage('examCenter') }}
              </p>
            </div>
          </div>
        </div>

        <!-- STEP 3: Address & Contact -->
        <div *ngIf="currentStep === 3" class="space-y-6 animate-fadeIn">
          <div class="bg-white rounded-xl p-5 sm:p-6 md:p-8 border-2 border-gray-200 shadow-lg">
            <div class="flex items-center mb-5 sm:mb-6">
              <div class="w-14 h-14 sm:w-16 sm:h-16 flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl mr-3 sm:mr-4 shadow-lg">
                <i class="ri-map-pin-line text-2xl sm:text-3xl text-white"></i>
              </div>
              <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-gray-900">Address & Contact</h2>
            </div>

            <!-- Full Postal Address -->
            <div class="mb-5 sm:mb-6">
              <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                Full Postal Address: <span class="text-red-600">*</span>
              </label>
              <textarea formControlName="fullPostalAddress" rows="3"
                class="w-full border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 resize-none"
                [class.border-red-500]="hasError('fullPostalAddress')"
                placeholder="Enter your complete postal address"></textarea>
              <p *ngIf="hasError('fullPostalAddress')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                <i class="ri-error-warning-line text-sm"></i>
                {{ getErrorMessage('fullPostalAddress') }}
              </p>
            </div>

            <!-- State, District, Pin Code -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5 mb-5 sm:mb-6">
              <div>
                <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                  State: <span class="text-red-600">*</span>
                </label>
                <mat-form-field appearance="fill" class="m-0 p-0 w-full">
                  <input type="text" matInput formControlName="state" 
                    [matAutocomplete]="autoState"
                    placeholder="Search or select state"
                    class="border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 w-full"
                    [class.border-red-500]="hasError('state')">
                  <mat-autocomplete #autoState="matAutocomplete" [displayWith]="displayState">
                    <mat-option *ngFor="let state of filteredStates | async" [value]="state" class="text-sm py-2.5 px-4 min-h-[40px] hover:bg-blue-50">
                      <i class="ri-map-pin-line text-blue-600 mr-2"></i>{{ state }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                <p *ngIf="hasError('state')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                  <i class="ri-error-warning-line text-sm"></i>
                  {{ getErrorMessage('state') }}
                </p>
              </div>

              <div>
                <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                  District: <span class="text-red-600">*</span>
                </label>
                <mat-form-field appearance="fill" class="m-0 p-0 w-full">
                  <input type="text" matInput formControlName="district" 
                    [matAutocomplete]="autoDistrict"
                    [placeholder]="examinationForm.get('state')?.value ? 'Search or select district' : 'Select State First'"
                    class="border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 w-full disabled:bg-gray-100 disabled:cursor-not-allowed"
                    [class.border-red-500]="hasError('district')"
                    [disabled]="!examinationForm.get('state')?.value">
                  <mat-autocomplete #autoDistrict="matAutocomplete" [displayWith]="displayDistrict">
                    <mat-option *ngFor="let district of filteredDistricts | async" [value]="district" class="text-sm py-2.5 px-4 min-h-[40px] hover:bg-blue-50">
                      <i class="ri-community-line text-blue-600 mr-2"></i>{{ district }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                <p *ngIf="hasError('district')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                  <i class="ri-error-warning-line text-sm"></i>
                  {{ getErrorMessage('district') }}
                </p>
              </div>

              <div>
                <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                  Pin Code: <span class="text-red-600">*</span>
                </label>
                <input type="text" formControlName="pinCode" maxlength="6" 
                  class="w-full border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                  placeholder="6 digits"
                  [class.border-red-500]="hasError('pinCode')">
                <p *ngIf="hasError('pinCode')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                  <i class="ri-error-warning-line text-sm"></i>
                  {{ getErrorMessage('pinCode') }}
                </p>
              </div>
            </div>

            <!-- Mobile Number and Email -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-5">
              <div>
                <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                  Mobile No.: <span class="text-red-600">*</span>
                </label>
                <input type="tel" formControlName="mobileNo" 
                  class="w-full border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                  placeholder="10 digits"
                  [class.border-red-500]="hasError('mobileNo')">
                <p *ngIf="hasError('mobileNo')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                  <i class="ri-error-warning-line text-sm"></i>
                  {{ getErrorMessage('mobileNo') }}
                </p>
              </div>

              <div>
                <label class="block font-bold text-sm sm:text-base text-gray-700 mb-2">
                  Email: <span class="text-gray-500 text-xs font-normal">(Optional)</span>
                </label>
                <input type="email" formControlName="email" 
                  class="w-full border-2 border-gray-300 bg-white px-3 py-2 text-sm rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                  placeholder="example@email.com"
                  [class.border-red-500]="hasError('email')">
                <p *ngIf="hasError('email')" class="text-red-600 text-xs mt-1.5 flex items-center gap-1">
                  <i class="ri-error-warning-line text-sm"></i>
                  {{ getErrorMessage('email') }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- STEP 4: Review & Submit -->
        <div *ngIf="currentStep === 4" class="space-y-6 animate-fadeIn">
          <div class="bg-white rounded-xl p-5 sm:p-6 md:p-8 border-2 border-gray-200 shadow-lg">
            <div class="flex items-center mb-5 sm:mb-6">
              <div class="w-14 h-14 sm:w-16 sm:h-16 flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl mr-3 sm:mr-4 shadow-lg">
                <i class="ri-file-check-line text-2xl sm:text-3xl text-white"></i>
              </div>
              <h2 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-gray-900">Review & Submit</h2>
            </div>

            <!-- Review Summary -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-5 sm:p-6 border-2 border-blue-200">
              <h3 class="text-lg sm:text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                <i class="ri-file-list-3-line text-blue-600"></i>
                Review Your Information
              </h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                <div>
                  <p class="text-gray-600 font-semibold mb-1">Enrolment Number:</p>
                  <p class="text-gray-900 font-bold">{{ examinationForm.get('enrolmentNumber')?.value || 'N/A' }}</p>
                </div>
                <div>
                  <p class="text-gray-600 font-semibold mb-1">Student Name:</p>
                  <p class="text-gray-900 font-bold">{{ examinationForm.get('studentName')?.value || 'N/A' }}</p>
                </div>
                <div>
                  <p class="text-gray-600 font-semibold mb-1">Course:</p>
                  <p class="text-gray-900 font-bold">{{ examinationForm.get('course')?.value || 'N/A' }}</p>
                </div>
                <div>
                  <p class="text-gray-600 font-semibold mb-1">Exam Type:</p>
                  <p class="text-gray-900 font-bold">{{ examinationForm.get('examType')?.value || 'N/A' }}</p>
                </div>
                <div>
                  <p class="text-gray-600 font-semibold mb-1">Exam Date:</p>
                  <p class="text-gray-900 font-bold">{{ examinationForm.get('examDate')?.value || 'N/A' }}</p>
                </div>
                <div>
                  <p class="text-gray-600 font-semibold mb-1">Subject:</p>
                  <p class="text-gray-900 font-bold">{{ examinationForm.get('subject')?.value || 'N/A' }}</p>
                </div>
                <div>
                  <p class="text-gray-600 font-semibold mb-1">Mobile No.:</p>
                  <p class="text-gray-900 font-bold">{{ examinationForm.get('mobileNo')?.value || 'N/A' }}</p>
                </div>
                <div>
                  <p class="text-gray-600 font-semibold mb-1">Email:</p>
                  <p class="text-gray-900 font-bold">{{ examinationForm.get('email')?.value || 'N/A' }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Success Message -->
        <div *ngIf="submitSuccess" class="mt-6 sm:mt-8 p-4 sm:p-5 bg-gradient-to-r from-green-50 to-green-100 border-l-4 border-green-500 text-green-800 rounded-lg shadow-lg print:hidden">
          <div class="flex items-center gap-3">
            <i class="ri-checkbox-circle-fill text-2xl sm:text-3xl text-green-600"></i>
            <div>
              <p class="font-bold text-base sm:text-lg">Form Submitted Successfully!</p>
              <p class="text-xs sm:text-sm mt-1">Form has been printed, downloaded, and email opened.</p>
            </div>
          </div>
        </div>

        <!-- Processing Message -->
        <div *ngIf="isProcessing" class="mt-6 sm:mt-8 p-4 sm:p-5 bg-gradient-to-r from-blue-50 to-blue-100 border-l-4 border-blue-500 text-blue-800 rounded-lg shadow-lg print:hidden">
          <div class="flex items-center gap-3">
            <i class="ri-loader-4-line text-2xl sm:text-3xl text-blue-600 animate-spin"></i>
            <div>
              <p class="font-bold text-base sm:text-lg">Processing...</p>
              <p class="text-xs sm:text-sm mt-1">Please wait while we process your form.</p>
            </div>
          </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="flex flex-wrap gap-3 sm:gap-4 justify-between mt-8 print:hidden">
          <button type="button" (click)="previousStep()" 
            *ngIf="currentStep > 1"
            [disabled]="isProcessing"
            class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white px-5 py-2.5 rounded-lg font-semibold text-sm transition-all shadow-md hover:shadow-lg transform hover:scale-105 disabled:transform-none flex items-center gap-2">
            <i class="ri-arrow-left-line text-base"></i>
            Previous
          </button>
          <div class="flex gap-3 sm:gap-4 ml-auto">
            <button type="button" (click)="resetForm()" 
              [disabled]="isProcessing"
              class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white px-5 py-2.5 rounded-lg font-semibold text-sm transition-all shadow-md hover:shadow-lg transform hover:scale-105 disabled:transform-none flex items-center gap-2">
              <i class="ri-refresh-line text-base"></i>
              Reset
            </button>
            <button type="submit" 
              [disabled]="isProcessing"
              class="bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed text-white px-6 py-2.5 rounded-lg font-semibold text-sm transition-all shadow-md hover:shadow-lg transform hover:scale-105 disabled:transform-none flex items-center gap-2">
              <i *ngIf="!isProcessing" class="ri-arrow-right-line text-base"></i>
              <i *ngIf="isProcessing" class="ri-loader-4-line text-base animate-spin"></i>
              {{ currentStep < totalSteps ? 'Next' : (isProcessing ? 'Processing...' : 'Submit Form') }}
            </button>
          </div>
        </div>
      </form>
      </div>
      <!-- End of Examination Form (verified section) -->
    </div>
  </div>
</div>
